<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruder Finn | Brand Intelligence Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ruder Finn Green */
        .rf-green {
            background-color: #289339;
        }
        .rf-green-text {
            color: #289339;
        }
        .rf-green-border {
            border-color: #289339;
        }
        /* Print styles */
        @media print {
            body {
                background-color: #fff;
            }
            body * {
                visibility: hidden;
            }
            #report-output, #report-output * {
                visibility: visible;
            }
            #report-output {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: none;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">
        <div class="w-full max-w-4xl mx-auto">
            
            <!-- Header -->
            <header class="text-center mb-8 no-print">
                <div class="text-4xl font-black text-gray-800 mb-4 tracking-tight">
                    Ruder Finn
                </div>
                <h1 class="text-3xl font-bold text-gray-800">Brand Intelligence Report Generator</h1>
                <p class="text-gray-600 mt-2">Enter a brand to get a real-time report on news, social media, and financials.</p>
            </header>

            <!-- Input Form -->
            <div id="input-form" class="bg-white p-8 rounded-xl shadow-lg border border-gray-200 mb-8 no-print">
                <div class="space-y-4">
                    <div>
                        <label for="brandName" class="block text-sm font-medium text-gray-700">Enter name of brand to generate report</label>
                        <input type="text" id="brandName" class="mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="e.g., Apple">
                    </div>
                    <div>
                        <label for="subcategory" class="block text-sm font-medium text-gray-700">Optional Descriptor (to refine search)</label>
                        <input type="text" id="subcategory" class="mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="e.g., computers">
                    </div>
                    <div>
                        <label for="competitor" class="block text-sm font-medium text-gray-700">Key Competitor (optional)</label>
                        <input type="text" id="competitor" class="mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="e.g., Microsoft">
                    </div>
                </div>
                <button id="generateBtn" class="mt-6 w-full rf-green text-white font-bold py-3 px-4 rounded-md hover:opacity-90 transition-all duration-300 transform hover:scale-105">
                    Generate Report
                </button>
            </div>

            <!-- Loading Indicator -->
            <div id="loader" class="text-center my-12 hidden">
                <svg class="animate-spin h-10 w-10 text-green-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-3 text-gray-600 font-medium">Generating report, please wait...</p>
            </div>
            
            <!-- Download Button -->
            <div id="download-container" class="text-center my-6 hidden no-print">
                 <button id="downloadBtn" class="bg-gray-700 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors shadow-sm">
                    Download as PDF
                </button>
            </div>
            
            <!-- Report Output -->
            <div id="report-output" class="bg-white p-8 sm:p-10 rounded-xl shadow-lg border border-gray-200">
                <!-- Report content will be injected here -->
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION: PASTE YOUR API KEYS HERE ---
        const NEWS_API_KEY = "0766d05ccde94899bffd87b9e98dfc1d";
        const ALPHA_VANTAGE_API_KEY = "A4LU34HWTJSU74KB";
        const YOUTUBE_API_KEY = "AIzaSyAi6cEjWBXzwXkJZ-Ps4M3fGvRbprZIOPE";
        // --- END OF CONFIGURATION ---

        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const loader = document.getElementById('loader');
        const reportOutput = document.getElementById('report-output');
        const downloadContainer = document.getElementById('download-container');

        generateBtn.addEventListener('click', generateReport);
        downloadBtn.addEventListener('click', () => window.print());

        async function generateReport() {
            const brandName = document.getElementById('brandName').value.trim();
            const subcategory = document.getElementById('subcategory').value.trim();
            const competitor = document.getElementById('competitor').value.trim();

            if (!brandName) {
                alert('Please enter a brand name.');
                return;
            }

            loader.classList.remove('hidden');
            reportOutput.innerHTML = '';
            downloadContainer.classList.add('hidden');

            const fullSearchQuery = subcategory ? `${brandName} ${subcategory}` : brandName;

            try {
                const [
                    newsData,
                    competitorData,
                    youtubeData,
                    redditData,
                    ticker,
                    linkedinData
                ] = await Promise.all([
                    fetchNews(fullSearchQuery),
                    competitor ? fetchNews(competitor, 5) : Promise.resolve([]),
                    fetchYouTube(fullSearchQuery),
                    fetchReddit(fullSearchQuery),
                    fetchTicker(brandName),
                    fetchLinkedInLinks(brandName)
                ]);
                
                const financialData = await fetchFinancials(ticker);
                const stockHistoryData = await fetchStockHistory(ticker);

                buildReport(brandName, ticker, financialData, stockHistoryData, linkedinData, youtubeData, redditData, newsData, competitor, competitorData);
                
            } catch (error) {
                console.error("Error generating report:", error);
                reportOutput.innerHTML = `<div class="text-red-500 text-center p-8">An error occurred while generating the report. This is often due to API rate limits on the free plans. Please try again in a few minutes. Check the console for details.</div>`;
            } finally {
                loader.classList.add('hidden');
                if(reportOutput.innerHTML && !reportOutput.innerHTML.includes('error')) {
                    downloadContainer.classList.remove('hidden');
                }
            }
        }
        
        // --- API Fetching Functions ---

        async function fetchNews(query, pageSize = 15) {
            const fromDate = new Date();
            fromDate.setDate(fromDate.getDate() - 30);
            const apiUrl = `https://newsapi.org/v2/everything?q="${query}"&from=${fromDate.toISOString().split('T')[0]}&sortBy=relevancy&language=en&pageSize=${pageSize}&apiKey=${NEWS_API_KEY}`;
            
            const proxyUrl = 'https://api.allorigins.win/raw?url=';
            const url = proxyUrl + encodeURIComponent(apiUrl);

            const response = await fetch(url);
            if (!response.ok) throw new Error(`News API error via proxy: ${response.statusText}`);
            const data = await response.json();
            return data.articles || [];
        }

        async function fetchYouTube(query) {
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}&type=video&order=relevance&maxResults=10&key=${YOUTUBE_API_KEY}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`YouTube API error: ${response.statusText}`);
            const data = await response.json();
            return data.items || [];
        }

        async function fetchReddit(query) {
            const url = `https://www.reddit.com/search.json?q=${query}&sort=top&t=month&limit=10`;
            const response = await fetch(url, { headers: { 'User-agent': 'Ruder Finn Report Bot 0.1' } });
            if (!response.ok) throw new Error(`Reddit API error: ${response.statusText}`);
            const data = await response.json();
            return data.data.children || [];
        }

        async function fetchTicker(brandName) {
            const url = `https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${brandName}&apikey=${ALPHA_VANTAGE_API_KEY}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Alpha Vantage Ticker error: ${response.statusText}`);
            const data = await response.json();
            if (data.Note) {
                console.warn("Alpha Vantage API limit reached for ticker search.");
                return null;
            }
            return data.bestMatches && data.bestMatches.length > 0 ? data.bestMatches[0]['1. symbol'] : null;
        }

        async function fetchFinancials(ticker) {
            if (!ticker) return null;
            const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=${ALPHA_VANTAGE_API_KEY}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Alpha Vantage Financials error: ${response.statusText}`);
            const data = await response.json();
            if (data.Note) {
                console.warn("Alpha Vantage API limit reached for financials.");
                return null;
            }
            return data['Global Quote'] || null;
        }
        
        async function fetchStockHistory(ticker) {
            if (!ticker) return null;
            const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${ticker}&outputsize=compact&apikey=${ALPHA_VANTAGE_API_KEY}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Alpha Vantage History error: ${response.statusText}`);
            const data = await response.json();
            if (data.Note) {
                console.warn("Alpha Vantage API limit reached for stock history.");
                return null;
            }
            return data['Time Series (Daily)'] || null;
        }

        function fetchLinkedInLinks(brandName) {
            const profiles = {
                "Company Page": `https://www.google.com/search?q=${encodeURIComponent(brandName + " company linkedin")}`,
                "CEO": `https://www.google.com/search?q=${encodeURIComponent(brandName + " CEO linkedin")}`,
                "CMO": `https://www.google.com/search?q=${encodeURIComponent(brandName + " CMO linkedin")}`,
                "Head of Communications": `https://www.google.com/search?q=${encodeURIComponent(brandName + " head of communications linkedin")}`
            };
            return Promise.resolve(profiles);
        }

        // --- Report Building Functions ---

        function buildReport(brandName, ticker, financialData, stockHistoryData, linkedinData, youtubeData, redditData, newsData, competitorName, competitorData) {
            const reportDate = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            let html = `<h2 class="text-3xl font-bold text-gray-900 mb-8">${brandName} — ${reportDate}</h2>`;
            
            const tocData = [];
            if (ticker && financialData) tocData.push({ title: 'Financial Snapshot', id: 'financials' });
            if (linkedinData) tocData.push({ title: 'Key LinkedIn Profiles', id: 'linkedin' });
            if (newsData.length > 0) tocData.push({ title: 'Recent News Highlights', id: 'news' });
            if (redditData.length > 0) tocData.push({ title: 'Reddit Community Buzz', id: 'reddit' });
            if (youtubeData.length > 0) tocData.push({ title: 'YouTube Mentions', id: 'youtube' });
            if (competitorName && competitorData.length > 0) tocData.push({ title: `Competitor: ${competitorName}`, id: 'competitor' });

            if (tocData.length > 0) {
                let tocHtml = tocData.map(item => `
                    <a href="#section-${item.id}" class="block text-blue-700 hover:underline font-medium">${item.title}</a>
                `).join('');
                html += createSection('Report Overview', tocHtml, '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" /></svg>', 'overview');
            }
            
            if (ticker && financialData) {
                html += createSection('Financial Snapshot', `
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        ${createFinancialItem('Price', financialData['05. price'], '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 10v-1m0 0c-1.657 0-3-.895-3-2s1.343-2 3-2 3-.895 3-2-1.343-2-3-2m0 10c-1.11 0-2.08-.402-2.599-1m5.198 0A9 9 0 1012 3a9 9 0 000 18z" /></svg>')}
                        ${createFinancialItem('Change', financialData['09. change'], '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>')}
                        ${createFinancialItem('Change %', financialData['10. change percent'], '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>')}
                        ${createFinancialItem('Volume', financialData['06. volume'], '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 20L20 4" /></svg>')}
                    </div>
                    <div class="chart-container bg-gray-50 p-4 rounded-lg"><canvas id="stockChart"></canvas></div>
                `, '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>', 'financials');
            }
            
            if (linkedinData) {
                let linkedinHtml = Object.entries(linkedinData).map(([role, url]) => createArticle(
                    `${role} Profile`,
                    url,
                    'Click to search on Google for this LinkedIn profile'
                )).join('');
                html += createSection('Key LinkedIn Profiles', linkedinHtml, '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207" /></svg>', 'linkedin');
            }

            if (newsData.length > 0) {
                let newsHtml = newsData.map(article => createArticle(
                    article.title,
                    article.url,
                    `${article.source.name} — ${new Date(article.publishedAt).toLocaleDateString()}`
                )).join('');
                html += createSection('Recent News Highlights', newsHtml, '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3h3m-3 4h3m-3 4h3m-3 4h3" /></svg>', 'news');
            }

            if (redditData.length > 0) {
                let redditHtml = redditData.map(post => createArticle(
                    post.data.title,
                    `https://www.reddit.com${post.data.permalink}`,
                    `r/${post.data.subreddit} — Score: ${post.data.score}`
                )).join('');
                html += createSection('Reddit Community Buzz', redditHtml, '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>', 'reddit');
            }
            
            if (youtubeData.length > 0) {
                let youtubeHtml = youtubeData.map(item => createArticle(
                    item.snippet.title,
                    `https://www.youtube.com/watch?v=${item.id.videoId}`,
                    `Channel: ${item.snippet.channelTitle}`
                )).join('');
                html += createSection('YouTube Mentions', youtubeHtml, '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>', 'youtube');
            }

            if (competitorName && competitorData.length > 0) {
                let competitorHtml = competitorData.map(article => createArticle(
                    article.title,
                    article.url,
                    `${article.source.name} — ${new Date(article.publishedAt).toLocaleDateString()}`
                )).join('');
                html += createSection(`Competitor Snapshot: ${competitorName}`, competitorHtml, '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M4 7a4 4 0 118 0 4 4 0 01-8 0z" /></svg>', 'competitor');
            }

            reportOutput.innerHTML = html;

            if (stockHistoryData) {
                renderStockChart(stockHistoryData);
            }
        }

        function createSection(title, content, icon, id) {
            return `
                <div class="mb-8" id="section-${id}">
                    <div class="flex items-center space-x-3 border-b-2 border-gray-200 pb-2 mb-4">
                        <span class="rf-green-text">${icon}</span>
                        <h3 class="text-xl font-bold rf-green-text">${title}</h3>
                    </div>
                    ${content}
                </div>
            `;
        }

        function createArticle(title, url, meta) {
            return `
                <div class="border-l-4 rf-green-border pl-4 mb-4 hover:bg-gray-50 transition-colors duration-200 py-2">
                    <h4 class="font-semibold text-lg"><a href="${url}" target="_blank" class="text-blue-700 hover:underline">${title}</a></h4>
                    <p class="text-sm text-gray-600">${meta}</p>
                </div>
            `;
        }
        
        function createFinancialItem(label, value, icon) {
            if (!value) return '';
            const colorClass = value.includes('-') ? 'text-red-600' : 'text-green-600';
            return `
                <div class="bg-gray-50 p-4 rounded-lg text-center border border-gray-200">
                    <div class="flex items-center justify-center space-x-2 text-gray-500">${icon} <span class="text-sm font-medium">${label}</span></div>
                    <p class="mt-1 text-2xl font-semibold ${label.includes('Change') ? colorClass : 'text-gray-900'}">${value}</p>
                </div>
            `;
        }

        function renderStockChart(history) {
            const labels = Object.keys(history).reverse();
            const dataPoints = Object.values(history).map(day => parseFloat(day['4. close'])).reverse();

            const ctx = document.getElementById('stockChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Closing Price (USD)',
                        data: dataPoints,
                        borderColor: '#289339',
                        backgroundColor: 'rgba(40, 147, 57, 0.1)',
                        borderWidth: 2.5,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            ticks: {
                                maxTicksLimit: 6,
                                font: {
                                    weight: '600'
                                }
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                             ticks: {
                                font: {
                                    weight: '600'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });
        }
    </script>
</body>
</html>
